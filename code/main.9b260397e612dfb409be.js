(()=>{"use strict";var t={307:(t,e,n)=>{n.r(e)},45:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.Api=void 0;class a{static async getCars(){const t=document.querySelector(".page-number");let e=1;t&&t.textContent&&(e=Number(t.textContent.slice(6)));const n=await fetch(`${a.garage}?_limit=7&_page=${e}`);if(!n.ok)throw new Error(`Ошибка по адресу ${a.garage}, статус ошибки ${n.status}`);return await n.json()}static async getCar(t){const e=await fetch(`${a.garage}/${t}`);if(!e.ok)throw new Error(`Ошибка по адресу ${a.garage}, статус ошибки ${e.status}`);return await e.json()}static async deleteCar(t){fetch(`${a.garage}/${t}`,{method:"DELETE"}).then((t=>t.json()))}static async getTotalCountOfCars(){const t=await fetch(`${a.garage}/?_page=[1]&_limit=[7]`),e=Number(t.headers.get("X-Total-Count"));if(e)return e}}e.Api=a,n=a,a.base="http://127.0.0.1:3000",a.garage=`${a.base}/garage`,a.engine=`${a.base}/engine`,a.createCar=async(t,e)=>{const r=await fetch(a.garage,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:`${t}`,color:`${e}`})});if(!r.ok)throw new Error(`Ошибка по адресу ${n.garage}, статус ошибки ${r.status}`);return r.json()},a.updateCar=async(t,e,n)=>{const r=await fetch(`${a.garage}/${n}`,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify({name:`${t}`,color:`${e}`})});if(!r.ok)throw new Error(`Ошибка по адресу ${a.garage}/${n}, статус ошибки ${r.status}`);return r.json()},a.startStopCar=async(t,e)=>{const n=await fetch(`${a.engine}?id=${t}&status=${e}`,{method:"PATCH"});if(!n.ok)throw new Error(`Ошибка по адресу ${a.engine}?id=${t}&status=${e}, \n      статус ошибки ${n.status}`);return n.json()},a.driveMode=async t=>{let e=!1;const n=await fetch(`${a.engine}?id=${t}&status=drive`,{method:"PATCH"});if(!n.ok){if(500===n.status)return e=!0,e;throw new Error(`Ошибка по адресу ${a.engine}?id=${t}&status=drive, \n      статус ошибки ${n.status}`)}return n.json()}},872:function(t,e,n){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Buttons=void 0;const r=a(n(781)),s=n(976);e.Buttons=[{id:s.PageIDs.Garage},{id:s.PageIDs.Winners}];class o extends r.default{constructor(t,n){super(t,n),this.content=`\n    <div class="header-wrapper">\n      <a href="#${e.Buttons[0].id}">\n      <h3>Garage</h3>\n      </a>\n      <a href="#${e.Buttons[1].id}">\n      <h3>Whinners</h3>\n      </a>\n    </div>\n    `,this.position="afterbegin"}}e.default=o},781:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.container=document.createElement(t),this.container.className=e,this.position="afterbegin",this.content=""}render(){return this.container.insertAdjacentHTML(this.position,this.content),this.container}}},976:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.PageIDs=void 0,(n=e.PageIDs||(e.PageIDs={})).Garage="Garage",n.Winners="Winners",e.default=class{constructor(){this.container=document.createElement("main"),this.position="afterbegin",this.content=""}render(){return this.container.insertAdjacentHTML(this.position,this.content),this.container}}},431:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UI=void 0,e.UI=class{static renderCar(t,e){t.insertAdjacentHTML("afterbegin",`\n    <div class="car-container car-container-${e.id}">\n    <div class="car-container__container-header">\n      <div class="car-container__car-handler">\n        <div data-start-id="${e.id}" class="start-button${e.id} car-container__green car-handler"></div>\n        <div style="pointer-events: none; opacity: 0.2" data-stop-id="${e.id}" \n        class="stop-button${e.id} car-container__red car-handler"></div>\n      </div>\n      <div class="car-container__title">\n        <h3>${e.name}</h3>\n      </div>\n    </div>\n    <div class="car-container__car-mechanics">\n      <div class="car-container__road-components">\n        <div class="car-container__road road">\n          <div class="car-container__car">\n          <svg width="60" height="23" viewBox="0 0 60 23" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path fill="${e.color}" \n            d="M30.6091 0.71875C31.7945 0.71875 32.943 1.11573 33.8914 1.84047L40.7332 7.01589L57.6356 \n            9.38246C58.7872 9.56364 59.5313 10.6918 59.1813 11.8128L57.4538 17.4899H54.0806C54.4176 \n            20.7056 52.1762 22.8203 49.3163 22.8203C46.4563 22.8203 44.1873 20.428 44.5519 17.4899H16.889C17.2917 \n            20.6962 14.9223 22.8203 12.1247 22.8203C9.32704 22.8203 6.99597 20.4256 7.36034 17.4899H0.463918C-0.179606 \n            17.4899 -0.731703 16.9451 -0.731702 16.2769V9.85668C-0.731702 9.24517 -0.282263 8.7367 0.304809 \n            8.65744L12.0474 7.01589L16.698 2.34661C17.7141 1.3048 19.1036 0.741398 \n            20.5713 0.71875H30.6091ZM25.672 2.6886H20.2758C19.4742 2.6886 18.7408 3.10573 \n            18.2892 3.77385L16.9572 5.7893C16.6276 6.35347 16.9865 6.90259 17.6027 \n            7.00222H25.672V2.6886ZM31.4774 2.69772H27.1995V7.00222H38.1692L33.2594 \n            3.29962C32.7514 2.9146 32.1096 2.69772 31.4774 2.69772Z" fill="black"/>\n          </svg>\n          </div>\n          <div class="car-container__flag">\n          <svg width="36" height="40" viewBox="0 0 36 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path fill-rule="evenodd" clip-rule="evenodd" d="M14.412 0.00295196C9.18852 0.123893 0.10199 \n          4.59708 0.10199 4.59708L2.21101 11.7527L9.69637 40L10.7722 39.7282L4.21209 15.5993C6.07463 \n          14.3849 11.1804 11.3699 15.2974 11.8547C18.0138 12.1746 18.649 13.4759 19.2215 14.6487C19.7312 \n          15.6929 20.1912 16.6352 22.0259 16.6921C25.9214 16.8131 35.306 12.5803 35.306 12.5803L30.104 \n          8.10539L32.2073 0.970438C32.2073 0.970438 23.8851 6.17071 22.1145 4.84041C21.6264 4.47374 \n          21.2191 3.93249 20.7756 3.34331C19.6103 1.7949 18.1957 -0.0846536 14.412 0.00295196Z" fill="black"/>\n          </svg>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="car-container__buttons">\n      <button data-select-id="${e.id}" name="select" class="car-button car-button-select">Select</button>\n      <div class="car-container__separator"></div>\n      <button data-remove-id="${e.id}" name="remove" class="car-button car-button-remove">Remove</button>\n    </div>\n  </div>\n    `)}}},607:function(t,e,n){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),n(307),(new(a(n(894)).default)).run()},894:function(t,e,n){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n(976),s=a(n(872)),o=n(109),i=n(544),c=a(n(535)),d=a(n(654));class u{static renderNewPage(t){const e=document.querySelector(`#${u.defaultPageID}`);e&&e.remove();let n=null;t===r.PageIDs.Garage?(n=new c.default,this.createDefaultPage(n),(new i.GarageHandler).render()):t===r.PageIDs.Winners&&(n=new d.default,this.createDefaultPage(n))}static createDefaultPage(t){const e=t.render();e.id=u.defaultPageID,u.container.append(e)}enableRoutPage(){window.addEventListener("hashchange",(()=>{console.log("ii");const t=o.URLData.getHash();t===r.PageIDs.Garage?u.renderNewPage(r.PageIDs.Garage):t===r.PageIDs.Winners&&u.renderNewPage(r.PageIDs.Winners)}))}constructor(){this.header=new s.default("header","header-container")}run(){u.container.appendChild(this.header.render());const t=o.URLData.getHash();t===r.PageIDs.Garage?u.renderNewPage(r.PageIDs.Garage):t===r.PageIDs.Winners?u.renderNewPage(r.PageIDs.Winners):u.renderNewPage(r.PageIDs.Garage),this.enableRoutPage()}}u.container=document.body,u.defaultPageID="current-page",e.default=u},109:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.URLData=void 0,e.URLData=class{static getStart(t){return window.location.hash.lastIndexOf(t)}static getHash(){let t="";const e=this.getStart("#");return t=window.location.hash.slice(e+1),t}}},575:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CarAnimation=void 0;const a=n(45);class r{startButton(t){return document.querySelector(`.start-button${t}`)}stopButton(t){return document.querySelector(`.stop-button${t}`)}carContainer(t){return document.querySelector(`.car-container-${t}`)}static ButtonSettings(t,e){e.style.pointerEvents="none",e.style.opacity="0.2",t.removeAttribute("style")}static async animateCar(t,e,n,s){const o=document.querySelector(`.car-container-${t} `),i=document.querySelector(`.stop-button${t} `);let c=null;o&&(c=o.querySelector(".car-container__car")),i&&r.ButtonSettings(i,n);let d=!1;i&&i.removeAttribute("style");const u=document.querySelector(".road").offsetWidth-60,l=Number(e.distance)/Number(e.velocity);i&&(r.addEventListenerStatus=!0,i.addEventListener("click",(()=>{d=!0,c&&(c.style.left="0px"),i&&r.ButtonSettings(n,i)}))),await a.Api.startStopCar(t,"started");const g=a.Api.driveMode(t);(()=>{const e=Date.now(),o=setInterval((async function(){const p=Date.now()-e;if(c&&(c.style.left=p/(l/u)+"px"),!0===d&&(clearInterval(o),c&&(c.style.left="0px"),i&&r.ButtonSettings(n,i)),g.then((()=>{clearInterval(o)})),p>l&&(clearInterval(o),await a.Api.startStopCar(t,"stopped"),!0===s)){const e={id:t,time:l};r.carsTimeArr.push(e),r.showWinnerCar()}}),20)})()}startRace(){const t=document.querySelector(".race-button");t&&t.addEventListener("click",(async()=>{(await a.Api.getCars()).forEach((async t=>{const e=await a.Api.startStopCar(t.id,"started"),n=this.startButton(t.id);n&&r.animateCar(t.id,e,n,!0)}))}))}resetRace(){const t=document.querySelector(".reset-button");t&&t.addEventListener("click",(async()=>{(await a.Api.getCars()).forEach((async t=>{await a.Api.startStopCar(t.id,"stopped");const e=this.carContainer(t.id);let n=null;e&&(n=e.querySelector(".car-container__car"));const s=this.startButton(t.id),o=this.stopButton(t.id);s&&o&&r.ButtonSettings(s,o),n&&(n.style.left="0px")}));const t=document.body.querySelector(".winner-message");t&&t.remove(),r.winnerCarStatusStatus=!1}))}static async showWinnerCar(){const t=r.carsTimeArr.reduce(((t,e)=>t.time<e.time?t:e)),e=await a.Api.getCar(t.id);!1===r.winnerCarStatusStatus&&(document.body.insertAdjacentHTML("afterbegin",`\n      <div class="winner-message" >\n        <h1>${e.name} went first[${t.time.toFixed(2)}s]</h1>\n      </div>\n        `),r.winnerCarStatusStatus=!0)}}e.CarAnimation=r,r.addEventListenerStatus=!1,r.winnerCarStatusStatus=!1,r.carsTimeArr=[]},30:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CarHandler=void 0;const a=n(45),r=n(544),s=n(431),o=n(290),i=n(575);class c{constructor(){this.carsContainer=document.querySelector(".cars-wrapper"),this.updateCarSettings=new o.UpdateCarSettings,this.carAnimation=new i.CarAnimation}static async setCarToGarage(){const t=await a.Api.getCars(),e=document.querySelector(".cars-wrapper");e&&(e.innerHTML=""),t.forEach((t=>{e&&s.UI.renderCar(e,t)}))}deleteCar(t){let e=null;e=Number(t.dataset.removeId),e&&(a.Api.deleteCar(e),c.setCarToGarage(),r.GarageHandler.setTotalCarsCount())}addEventListener(t){const e=t=>this.deleteCar(t),n=t=>this.updateCarSettings.start(t);t.addEventListener("click",(async function(t){const r=t.target;if(r&&"BUTTON"===r.tagName&&(r.classList.contains("car-button-remove")&&e(r),r.classList.contains("car-button-select")&&n(r)),r&&"DIV"===r.tagName&&r.classList.contains("car-container__green")){const t=r.dataset.startId;if(t){const e=Number(t),n=await a.Api.startStopCar(e,"started");i.CarAnimation.animateCar(e,n,r)}}}))}start(){this.addEventListener(this.carsContainer),this.carAnimation.startRace(),this.carAnimation.resetRace()}}e.CarHandler=c},579:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CreateCarSettings=void 0;const a=n(30),r=n(45),s=n(92),o=n(544);e.CreateCarSettings=class{constructor(){this.createInputContainer=document.querySelector(".settings-container__create-car"),this.createButton=document.querySelector(".create-button"),this.carSettingsObj={name:"BMW",color:"#000000"}}createCar(t,e){const n=this.carSettingsObj;t.addEventListener("click",(()=>{s.InputDataHandler.getData(e,n),r.Api.createCar(n.name,n.color),a.CarHandler.setCarToGarage(),o.GarageHandler.setTotalCarsCount(),s.InputDataHandler.removeData(e)})),this.carSettingsObj=n}start(){this.createCar(this.createButton,this.createInputContainer)}}},535:function(t,e,n){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=a(n(976));class s extends r.default{constructor(){super(),this.content='\n    <div class="settings-container">\n    <div class="settings-container__create-car settings">\n      <input class="text-input" type="text" list="add-car-brands">  \n      <datalist id="add-car-brands">\n        <option value="Audi"></option>\n        <option value="BMW"></option>\n        <option value="Toyota"></option>\n        <option value="Lada"></option>\n        <option value="Honda"></option>\n        <option value="Ford"></option>\n      </datalist>\n      <div class="color">\n        <input class="color-input" type="color" name="head">\n      </div>\n      <button class="create-button">Create</button>\n    </div>\n    <div class="settings-container__update-car settings">\n      <input class="text-input" type="text" list="change-car-brands">\n      <datalist id="change-car-brands">\n        <option value="Audi"></option>\n        <option value="BMW"></option>\n        <option value="Toyota"></option>\n        <option value="Lada"></option>\n        <option value="Honda"></option>\n        <option value="Ford"></option>\n      </datalist>\n      <div class="color">\n        <input class="color-input" type="color" name="head">\n      </div>\n      <button class="update-button">Update</button>\n    </div>\n    <div class="settings-container__garage-handler">\n      <button class=\'race-button\'>RACE</button>\n      <button class=\'reset-button\'>RESET</button>\n      <button>GENERATE CARS</button>\n    </div>\n  </div>\n  <div class="garage-container">\n  <div class="garage-container__total-cars">\n    <h1>Garage (4)</h1>\n  </div>\n  <div class="garage-container__garage-content">\n    <div class="garage-container__page">\n      <div class="page-switch-container">\n      <h2 class="page-number">Page #1</h2>\n      <button class="page-button back">ᐸ</button>\n      <button class="page-button next">ᐳ</button>\n    </div>\n      <div class="cars-wrapper">\n      </div>\n    </div>\n  </div>\n</div>\n    '}render(){return super.render()}}e.default=s},544:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GarageHandler=void 0;const a=n(45),r=n(30),s=n(579),o=n(92),i=n(615);class c{constructor(){this.carHandler=new r.CarHandler,this.createCarSettings=new s.CreateCarSettings,this.pagination=new i.Pagination}static async setTotalCarsCount(){const t=document.querySelector(".garage-container__total-cars"),e=await a.Api.getTotalCountOfCars();t.innerHTML=`<h1>Garage (${e})`}render(){o.InputDataHandler.startInputColor(),c.setTotalCarsCount(),this.carHandler.start(),this.createCarSettings.start(),this.pagination.start(),r.CarHandler.setCarToGarage()}}e.GarageHandler=c},92:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InputDataHandler=void 0;const a=n(30);class r{constructor(){this.carsContainer=document.querySelector(".cars-wrapper"),this.carHandler=new a.CarHandler}static startInputColor(){document.querySelectorAll(".color-input").forEach((t=>{t&&(t.value="#9dbeb7")}))}static setData(t,e){const n=t.querySelector(".text-input"),a=t.querySelector(".color-input");return n&&(n.value=e.name),a&&(a.value=e.color),{name:`${e.name}`,color:`${e.color}`}}static getData(t,e){const n=t.querySelector(".text-input"),a=t.querySelector(".color-input");n&&n.value.length>0&&(e.name=n.value),a&&(e.color=a.value)}static removeData(t){const e=t.querySelector(".text-input"),n=t.querySelector(".color-input");e&&(e.value=""),n&&(n.value=""),r.startInputColor()}}e.InputDataHandler=r},615:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Pagination=void 0;const a=n(30);class r{constructor(){this.nextButton=document.querySelector(".next"),this.backButton=document.querySelector(".back")}static getPageTitle(){return document.querySelector(".page-number")}static getPageNumber(){const t=r.getPageTitle();let e=1;return t&&t.textContent&&(e=Number(t.textContent.slice(6))),e}nextButtonHandler(){const t=r.getPageTitle();this.nextButton&&this.nextButton.addEventListener("click",(()=>{let e=r.getPageNumber();e++,t&&(t.textContent=`Page #${e}`),a.CarHandler.setCarToGarage()}))}backButtonHandler(){const t=r.getPageTitle();this.backButton&&this.backButton.addEventListener("click",(()=>{let e=r.getPageNumber();1!==e&&(e--,t&&(t.textContent=`Page #${e}`),a.CarHandler.setCarToGarage())}))}start(){this.nextButtonHandler(),this.backButtonHandler()}}e.Pagination=r},290:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UpdateCarSettings=void 0;const a=n(30),r=n(45),s=n(92);e.UpdateCarSettings=class{constructor(){this.updateInputContainer=document.querySelector(".settings-container__update-car"),this.updateButton=document.querySelector(".update-button"),this.carSettingsObj={name:"BMW",color:"#000000"}}async selectCar(t){let e=null;if(e=Number(t.dataset.selectId),!e)return;const n=await r.Api.getCar(e),a=s.InputDataHandler.setData(this.updateInputContainer,n);this.carSettingsObj=a,this.updateCar(this.updateButton,this.updateInputContainer,n,e)}updateCar(t,e,n,o){const i=this.carSettingsObj,c=()=>{s.InputDataHandler.getData(e,i),r.Api.updateCar(i.name,i.color,o),s.InputDataHandler.removeData(e),t.removeEventListener("click",c),a.CarHandler.setCarToGarage()};t.addEventListener("click",c)}start(t){this.selectCar(t)}}},654:function(t,e,n){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=a(n(976));class s extends r.default{constructor(){super(),this.content='\n    <div class="winner-container">\n    <div class="winner-container__total-cars">\n      <h1>Garage (4)</h1>\n    </div>\n    <div class="winner-container__winner-content">\n      <div class="winner-container__page">\n        <div class="page-switch-container">\n          <h2 class="page-number">Page #1</h2>\n          <button class="page-button back">ᐸ</button>\n          <button class="page-button next">ᐳ</button>\n        </div>\n        <div class="winner-wrapper">\n          <div class="winner-wrapper__title-container">\n            <table class="table">\n              <thead>\n                <tr>\n                  <th>Page</th>\n                  <th>Nuber</th>\n                  <th>Car</th>\n                  <th>Name</th>\n                  <th>Wins</th>\n                  <th>Bst Time</th>\n                </tr>\n              </thead>\n              <tbody id="tbody">\n                \x3c!-- <tr>\n                  <td>Gloria</td>\n                  <td>Reeves</td>\n                  <td>67439</td>\n                  <td>10/18/1985</td>\n                  <td>4</td>\n                  <td>0.1</td>\n                  <td>$50</td>\n                </tr> --\x3e\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n    '}render(){return super.render()}}e.default=s}},e={};function n(a){var r=e[a];if(void 0!==r)return r.exports;var s=e[a]={exports:{}};return t[a].call(s.exports,s,s.exports,n),s.exports}n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(607)})();